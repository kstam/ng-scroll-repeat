/*
Angular Scroll Repeat v0.0.4 by @kstam
Copyright (c) 2014

Full source at https://github.com/kstam/ng-scroll-repeat

MIT License, https://github.com/kstam/ng-scroll-repeat/blob/master/LICENSE
*/
angular.module("ks.ngScrollRepeat",["ks.WindowService"]).directive("ngScrollRepeat",["$compile","WindowService",function(r,e){"use strict";var t=50,o=200,n="bottom-reached-before",i="bottom-reached-after",l=function(r,e){r.$$phase||r.$root.$$phase?e():r.$apply(e)},c=function(r){if(r.match(/limitTo/)||r.match(/startFrom/))throw new Error('"limitTo" and "startFrom" filters are not allowed in scroll-repeat directive')},a=function(r){var t=e.height(),o=r.offset().top-e.scrollTop()+r.height();return o-t},s=function(s,u){var f=u.ngScrollRepeat,p=f.match(/^\s*(.+)\s+in\s+(.*?)\s*(\s+track\s+by\s+(.+)\s*)?$/),d=p[2],g=u.pageSize?Number(u.pageSize):t,h=u.tolerance?Number(u.tolerance):o;return c(f),s.removeAttr("ng-scroll-repeat"),s.attr("ng-repeat",f+" | limitTo:visibleResults"),function(t,o){var c,s=$(o[0]).parent();t.visibleResults=g,r(o)(t),t.$watch(d,function(r){c=r.length,t.visibleResults=g},!0),t.$on(e.WINDOW_SCROLL,function(){var r=a(s);h>=r&&c>t.visibleResults&&(t.$broadcast(n),l(t,function(){t.visibleResults+=g}),t.$broadcast(i))}),e.registerForScroll(t),t.$on("$destroy",function(){e.deregisterForScroll(t)})}};return{replace:!1,terminal:!0,priority:2e3,restrict:"A",compile:s}}]),angular.module("ks.WindowService",[]).factory("WindowService",["$window",function(r){var e=angular.element(r),t="WINDOW_SCROLL",o=[];return e.on("scroll",function(){var r;for(var e in o)r=o[e],r.$broadcast(t)}),{WINDOW_SCROLL:t,height:function(){return e.height()},scrollTop:function(){return e.scrollTop()},registerForScroll:function(r){if(!r||!angular.isFunction(r.$broadcast))throw new Error("Cannot register a non-scope object for scroll");o.push(r)},deregisterForScroll:function(r){o.splice(o.indexOf(r),1)}}}]);